openapi: 3.0.3
info:
  title: Video Transcription API
  description: |
    Professional video transcription service with AI enhancement capabilities.
    
    This API transcribes MP4 video files to text and provides AI-powered analysis including:
    - High-quality speech-to-text transcription
    - Text enhancement and formatting
    - Intelligent summaries
    - Key point extraction
    - Topic identification
    - Sentiment analysis
    
    Perfect for meeting recordings, interviews, lectures, and any video content requiring transcription.
  version: 1.0.0
  contact:
    name: Andy Cohen
    email: andy@iamandycohen.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://video-transcribe-api.calmocean-ce622c12.eastus2.azurecontainerapps.io
    description: Production API server
  - url: http://localhost:3000
    description: Local development server

security:
  - ApiKeyAuth: []

paths:
  /transcribe:
    post:
      summary: Transcribe Video File
      description: |
        Transcribe an MP4 video file to text with optional AI enhancement.
        
        This endpoint processes video files and returns:
        - Raw transcription text
        - Enhanced, formatted text (if enhancement enabled)
        - Intelligent summary
        - Key discussion points
        - Main topics covered
        - Overall sentiment analysis
        
        Supports both local file paths and remote URLs.
      operationId: transcribeVideo
      tags:
        - Transcription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - videoPath
              properties:
                videoPath:
                  type: string
                  description: |
                    Path to the MP4 video file to transcribe. Can be:
                    - Local file path (e.g., "./meeting.mp4")
                    - HTTP/HTTPS URL to a video file
                    - Cloud storage URL (Azure Blob, AWS S3, etc.)
                  example: "./meeting-recording.mp4"
                enhance:
                  type: boolean
                  description: Enable AI enhancement for better formatting and analysis
                  default: true
                  example: true
                outputFormat:
                  type: string
                  enum: [json, txt, both]
                  description: Format for the transcription output
                  default: json
                  example: json
            examples:
              basic_transcription:
                summary: Basic transcription
                value:
                  videoPath: "./interview.mp4"
                  enhance: true
                  outputFormat: json
              url_transcription:
                summary: Transcribe from URL
                value:
                  videoPath: "https://example.com/meeting.mp4"
                  enhance: true
                  outputFormat: json
              quick_transcription:
                summary: Quick transcription without enhancement
                value:
                  videoPath: "./quick-note.mp4"
                  enhance: false
                  outputFormat: txt
      responses:
        '200':
          description: Transcription completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Whether the transcription was successful
                    example: true
                  transcription:
                    type: string
                    description: The transcribed text (enhanced if enhancement was enabled)
                    example: "Good morning everyone. Today we'll be discussing the quarterly results and our strategic initiatives for the upcoming period. The main focus areas include customer acquisition, product development, and operational efficiency improvements."
                  summary:
                    type: string
                    description: AI-generated summary of the content (if enhancement enabled)
                    example: "Quarterly business review meeting covering financial results and strategic planning for customer growth, product development, and operational improvements."
                  keyPoints:
                    type: array
                    items:
                      type: string
                    description: Key discussion points extracted from the content
                    example: 
                      - "Quarterly financial results review"
                      - "Customer acquisition strategy discussion"
                      - "Product development roadmap planning"
                      - "Operational efficiency improvement initiatives"
                  topics:
                    type: array
                    items:
                      type: string
                    description: Main topics identified in the conversation
                    example: ["business strategy", "quarterly results", "customer acquisition", "product development"]
                  sentiment:
                    type: string
                    enum: [positive, neutral, negative]
                    description: Overall sentiment of the conversation
                    example: "positive"
                  outputFiles:
                    type: array
                    items:
                      type: string
                    description: Paths to generated output files (if applicable)
                    example: ["./output/meeting_20240917_transcription.json"]
                  metadata:
                    type: object
                    properties:
                      authMethod:
                        type: string
                        description: Authentication method used
                        example: "api-key"
                      timestamp:
                        type: string
                        format: date-time
                        description: Processing timestamp
                        example: "2024-09-17T15:30:45.123Z"
              examples:
                successful_transcription:
                  summary: Successful transcription with enhancement
                  value:
                    success: true
                    transcription: "Good morning everyone. Today we'll be discussing the quarterly results and our strategic initiatives for the upcoming period."
                    summary: "Quarterly business review meeting covering financial results and strategic planning."
                    keyPoints:
                      - "Quarterly financial results review"
                      - "Strategic initiatives planning"
                      - "Team alignment on priorities"
                    topics: ["business strategy", "quarterly results", "team meeting"]
                    sentiment: "positive"
                    outputFiles: ["./output/meeting_transcription.json"]
                    metadata:
                      authMethod: "api-key"
                      timestamp: "2024-09-17T15:30:45.123Z"
        '400':
          description: Bad request - invalid input parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_video_path:
                  summary: Missing video path
                  value:
                    success: false
                    error: "videoPath is required"
                invalid_file:
                  summary: Invalid file format
                  value:
                    success: false
                    error: "Invalid or inaccessible MP4 file: ./nonexistent.mp4"
        '401':
          description: Unauthorized - invalid or missing API key
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized - Valid authentication required"
                  supportedMethods:
                    type: array
                    items:
                      type: string
                    example: ["X-API-Key: <your-api-key>", "Authorization: Bearer <azure-managed-identity-token>"]
                  hint:
                    type: string
                    example: "For direct API access: Include X-API-Key header. For Azure AI Foundry: Managed identity is handled automatically."
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                processing_error:
                  summary: Processing error
                  value:
                    success: false
                    error: "Audio extraction failed: Invalid video format"

  /health:
    get:
      summary: Health Check
      description: Check the health status of the transcription service and its dependencies
      operationId: healthCheck
      tags:
        - Monitoring
      security: []  # No authentication required for health check
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  healthy:
                    type: boolean
                    description: Overall service health status
                    example: true
                  services:
                    type: object
                    properties:
                      azure:
                        type: boolean
                        description: Azure services connectivity
                        example: true
                      audioExtractor:
                        type: boolean
                        description: Audio extraction service status
                        example: true
                      transcription:
                        type: boolean
                        description: Speech-to-text service status
                        example: true
                      gptEnhancement:
                        type: boolean
                        description: AI enhancement service status
                        example: true
                  capabilities:
                    type: array
                    items:
                      type: string
                    description: Available service capabilities
                    example: ["video_transcription", "audio_extraction", "speech_to_text", "gpt_enhancement"]
                  auth:
                    type: object
                    properties:
                      method:
                        type: string
                        example: "anonymous"
                      authenticated:
                        type: boolean
                        example: false
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-09-17T15:30:45.123Z"
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  healthy:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Azure connection failed"

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API key for authentication. Include your API key in the X-API-Key header.
        
        Example: `X-API-Key: your-api-key-here`

  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error message describing what went wrong
          example: "Invalid video file format"
      required:
        - success
        - error

tags:
  - name: Transcription
    description: Video transcription and AI enhancement operations
  - name: Monitoring
    description: Service health and monitoring endpoints

externalDocs:
  description: Full API Documentation and Integration Guide
  url: https://github.com/iamandycohen/video-transcribe
